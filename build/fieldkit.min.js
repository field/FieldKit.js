(function(e,t,n,r){function i(r){if(!n[r]){if(!t[r]){if(e)return e(r);throw new Error("Cannot find module '"+r+"'")}var s=n[r]={exports:{}};t[r][0](function(e){var n=t[r][1][e];return i(n?n:e)},s,s.exports)}return n[r].exports}for(var s=0;s<r.length;s++)i(r[s]);return i})(typeof require!=="undefined"&&require,{1:[function(require,module,exports){(function(){var extend,fk,util;util=require("./util");extend=function(){var pkg;switch(arguments.length){case 1:return util.extend(fk,arguments[0]);case 2:pkg=arguments[0];if(fk[pkg]==null){fk[pkg]={}}return util.extend(fk[pkg],arguments[1])}};fk={};extend(require("./color"));extend(require("./time"));extend("math",require("./math/math"));extend("math",require("./math/random"));extend("math",require("./math/noise"));extend("math",require("./math/vector"));extend("math",require("./math/rect"));extend("util",util);extend("physics",require("./physics/physics"));extend("physics",require("./physics/particle"));extend("physics",require("./physics/behaviours"));extend("physics",require("./physics/constraints"));extend("client",require("./client/sketch"));module.exports=fk;if(typeof window!=="undefined"&&window!==null){window.fk=fk}}).call(this)},{"./util":2,"./color":3,"./time":4,"./math/math":5,"./math/random":6,"./math/noise":7,"./math/vector":8,"./math/rect":9,"./physics/physics":10,"./physics/particle":11,"./physics/behaviours":12,"./physics/constraints":13,"./client/sketch":14}],2:[function(require,module,exports){(function(){var util;util={};util.extend=function(obj,source){var i,il,keys,prop,safeHasOwnProperty;if(Object.keys){keys=Object.keys(source);i=0;il=keys.length;while(i<il){prop=keys[i];Object.defineProperty(obj,prop,Object.getOwnPropertyDescriptor(source,prop));i++}}else{safeHasOwnProperty={}.hasOwnProperty;for(prop in source){if(safeHasOwnProperty.call(source,prop)){obj[prop]=source[prop]}}}return obj};util.removeElement=function(element,list){var index;index=list.indexOf(element);if(index!==-1){list.splice(index,1)}return list};util.shuffle=function(object,rng){var i,j,x;if(rng==null){rng=Math}i=object.length;while(i){j=parseInt(rng.random()*i);x=object[--i];object[i]=object[j];object[j]=x}return object};module.exports=util}).call(this)},{}],3:[function(require,module,exports){(function(){var Color;Color=function(){Color.prototype.r=1;Color.prototype.g=1;Color.prototype.b=1;Color.prototype.a=1;function Color(r,g,b,a){this.r=r!=null?r:1;this.g=g!=null?g:1;this.b=b!=null?b:1;this.a=a!=null?a:1}Color.prototype.set=function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this};Color.prototype.randomize=function(){this.r=Math.random();this.g=Math.random();this.b=Math.random();return this};Color.prototype.clone=function(){return new Color(this.r,this.g,this.b,this.a)};Color.prototype.equals=function(other){if(other==null){return false}return this.r===other.r&&this.g===other.g&&this.b===other.b&&this.a===other.a};Color.prototype.toCSS=function(){var b,g,r;r=Math.floor(255*this.r);g=Math.floor(255*this.g);b=Math.floor(255*this.b);return"rgba("+r+","+g+","+b+","+this.a+")"};Color.prototype.toString=function(){return"fk.Color("+this.r+","+this.g+","+this.b+","+this.a+")"};return Color}();module.exports={Color:Color}}).call(this)},{}],4:[function(require,module,exports){(function(){var Tempo,Timer;Timer=function(){Timer.prototype.now=null;Timer.prototype.prev=null;function Timer(){this.reset()}Timer.prototype.update=function(){var dt;this.now=Date.now();dt=this.now-this.prev;this.prev=this.now;return dt};Timer.prototype.elapsed=function(){return Date.now()-this.prev};Timer.prototype.reset=function(){return this.now=this.prev=Date.now()};return Timer}();Tempo=function(){Tempo.prototype.bpm=120;Tempo.prototype.sigNum=4;Tempo.prototype.sigDenom=4;Tempo.prototype.resolution=32;Tempo.prototype.beatInterval=0;Tempo.prototype.gridInterval=0;Tempo.prototype.time=0;Tempo.prototype.prevEvent=0;Tempo.prototype.beats=0;Tempo.prototype.bars=0;Tempo.prototype.beat=0;Tempo.prototype.onBeat=false;Tempo.prototype.onBar=false;Tempo.prototype.on64=false;Tempo.prototype.on32=false;Tempo.prototype.on16=false;Tempo.prototype.on8=false;Tempo.prototype.on4=false;Tempo.prototype.on2=false;function Tempo(bpm,sigNum,sigDenom,resolution){this.bpm=bpm!=null?bpm:120;this.sigNum=sigNum!=null?sigNum:4;this.sigDenom=sigDenom!=null?sigDenom:4;this.resolution=resolution!=null?resolution:32;this.reset()}Tempo.prototype.reset=function(){this.beatInterval=1e3/(this.bpm/60);this.gridInterval=this.beatInterval*this.sigNum/this.resolution;this.time=this.prevEvent=0;this.beats=0;this.beat=this.bars=0;this.onBeat=this.onBar=false;return this.on64=this.on32=this.on16=this.on8=this.on4=this.on2=false};Tempo.prototype.update=function(dt){var forceOnGrid;forceOnGrid=this.time-this.prevEvent>=this.gridInterval;this.setTime(this.time+dt,forceOnGrid);return this.beat};Tempo.prototype.setTime=function(time,forceOnGrid){var gridUnits,r,u;this.time=time;if(this.time%this.gridInterval===0||forceOnGrid){this.prevEvent=time;gridUnits=Math.floor(this.time/this.gridInterval);u=gridUnits;r=this.resolution;this.beats=Math.floor(this.time/this.beatInterval);this.bars=Math.floor(this.beats/this.sigDenom);this.beat=this.beats%this.sigNum;this.onBeat=u%(r/this.sigNum)===0;this.onBar=u%this.resolution===0;this.on64=u%(r/64)===0;this.on32=u%(r/32)===0;this.on16=u%(r/16)===0;this.on8=u%(r/8)===0;this.on4=u%(r/4)===0;this.on2=u%(r/2)===0}else{this.onBeat=this.onBar=false;this.on64=this.on32=this.on16=this.on8=this.on4=this.on2=false}return this.beat};return Tempo}();module.exports={Timer:Timer,Tempo:Tempo}}).call(this)},{}],7:[function(require,module,exports){(function(){var FlowNoise,Noise,SimplexNoise,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Noise=function(){function Noise(){}Noise.prototype.noise=function(x,y){return 0};Noise.prototype.noise2=function(x,y){return 0};Noise.prototype.noise3=function(x,y,z){return 0};Noise.prototype.noise4=function(x,y,z,w){return 0};return Noise}();SimplexNoise=function(_super){var dot;__extends(SimplexNoise,_super);function SimplexNoise(rng){var i,_i,_j;if(rng==null){rng=Math}this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]];this.p=[];i=0;for(i=_i=0;_i<=256;i=++_i){this.p[i]=Math.floor(rng.random()*256)}this.perm=[];for(i=_j=0;_j<=512;i=++_j){this.perm[i]=this.p[i&255]}this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot=function(g,x,y){return g[0]*x+g[1]*y};SimplexNoise.prototype.noise2=function(xin,yin){var F2,G2,X0,Y0,gi0,gi1,gi2,i,i1,ii,j,j1,jj,n0,n1,n2,s,t,t0,t1,t2,x0,x1,x2,y0,y1,y2;n0=0;n1=0;n2=0;F2=.5*(Math.sqrt(3)-1);s=(xin+yin)*F2;i=Math.floor(xin+s);j=Math.floor(yin+s);G2=(3-Math.sqrt(3))/6;t=(i+j)*G2;X0=i-t;Y0=j-t;x0=xin-X0;y0=yin-Y0;i1=0;j1=0;if(x0>y0){i1=1;j1=0}else{i1=0;j1=1}x1=x0-i1+G2;y1=y0-j1+G2;x2=x0-1+2*G2;y2=y0-1+2*G2;ii=i&255;jj=j&255;gi0=this.perm[ii+this.perm[jj]]%12;gi1=this.perm[ii+i1+this.perm[jj+j1]]%12;gi2=this.perm[ii+1+this.perm[jj+1]]%12;t0=.5-x0*x0-y0*y0;if(!(t0<0)){t0*=t0;n0=t0*t0*dot(this.grad3[gi0],x0,y0)}t1=.5-x1*x1-y1*y1;if(!(t1<0)){t1*=t1;n1=t1*t1*dot(this.grad3[gi1],x1,y1)}t2=.5-x2*x2-y2*y2;if(!(t2<0)){t2*=t2;n2=t2*t2*dot(this.grad3[gi2],x2,y2)}return 70*(n0+n1+n2)};SimplexNoise.prototype.noise3=function(xin,yin,zin){var F3,G3,X0,Y0,Z0,gi0,gi1,gi2,gi3,i,i1,i2,ii,j,j1,j2,jj,k,k1,k2,kk,n0,n1,n2,n3,s,t,t0,t1,t2,t3,x0,x1,x2,x3,y0,y1,y2,y3,z0,z1,z2,z3;n0=0;n1=0;n2=0;n3=0;F3=1/3;s=(xin+yin+zin)*F3;i=Math.floor(xin+s);j=Math.floor(yin+s);k=Math.floor(zin+s);G3=1/6;t=(i+j+k)*G3;X0=i-t;Y0=j-t;Z0=k-t;x0=xin-X0;y0=yin-Y0;z0=zin-Z0;i1=0;j1=0;k1=0;i2=0;j2=0;k2=0;if(x0>=y0){if(y0>=z0){i1=1;j1=0;k1=0;i2=1;j2=1;k2=0}else if(x0>=z0){i1=1;j1=0;k1=0;i2=1;j2=0;k2=1}else{i1=0;j1=0;k1=1;i2=1;j2=0;k2=1}}else{if(y0<z0){i1=0;j1=0;k1=1;i2=0;j2=1;k2=1}else if(x0<z0){i1=0;j1=1;k1=0;i2=0;j2=1;k2=1}else{i1=0;j1=1;k1=0;i2=1;j2=1;k2=0}}x1=x0-i1+G3;y1=y0-j1+G3;z1=z0-k1+G3;x2=x0-i2+2*G3;y2=y0-j2+2*G3;z2=z0-k2+2*G3;x3=x0-1+3*G3;y3=y0-1+3*G3;z3=z0-1+3*G3;ii=i&255;jj=j&255;kk=k&255;gi0=this.perm[ii+this.perm[jj+this.perm[kk]]]%12;gi1=this.perm[ii+i1+this.perm[jj+j1+this.perm[kk+k1]]]%12;gi2=this.perm[ii+i2+this.perm[jj+j2+this.perm[kk+k2]]]%12;gi3=this.perm[ii+1+this.perm[jj+1+this.perm[kk+1]]]%12;t0=.6-x0*x0-y0*y0-z0*z0;if(!(t0<0)){t0*=t0;n0=t0*t0*dot(this.grad3[gi0],x0,y0,z0)}t1=.6-x1*x1-y1*y1-z1*z1;if(!(t1<0)){t1*=t1;n1=t1*t1*dot(this.grad3[gi1],x1,y1,z1)}t2=.6-x2*x2-y2*y2-z2*z2;if(!(t2<0)){t2*=t2;n2=t2*t2*dot(this.grad3[gi2],x2,y2,z2)}t3=.6-x3*x3-y3*y3-z3*z3;if(!(t3<0)){t3*=t3;n3=t3*t3*dot(this.grad3[gi3],x3,y3,z3)}return 32*(n0+n1+n2+n3)};SimplexNoise.prototype.noise4=function(x,y,z,w){var F4,G4,W0,X0,Y0,Z0,c,c1,c2,c3,c4,c5,c6,gi0,gi1,gi2,gi3,gi4,grad4,i,i1,i2,i3,ii,j,j1,j2,j3,jj,k,k1,k2,k3,kk,l,l1,l2,l3,ll,n0,n1,n2,n3,n4,perm,s,simplex,t,t0,t1,t2,t3,t4,w0,w1,w2,w3,w4,x0,x1,x2,x3,x4,y0,y1,y2,y3,y4,z0,z1,z2,z3,z4;grad4=this.grad4;simplex=this.simplex;perm=this.perm;F4=(Math.sqrt(5)-1)/4;G4=(5-Math.sqrt(5))/20;n0=0;n1=0;n2=0;n3=0;n4=0;s=(x+y+z+w)*F4;i=Math.floor(x+s);j=Math.floor(y+s);k=Math.floor(z+s);l=Math.floor(w+s);t=(i+j+k+l)*G4;X0=i-t;Y0=j-t;Z0=k-t;W0=l-t;x0=x-X0;y0=y-Y0;z0=z-Z0;w0=w-W0;c1=x0>y0?32:0;c2=x0>z0?16:0;c3=y0>z0?8:0;c4=x0>w0?4:0;c5=y0>w0?2:0;c6=z0>w0?1:0;c=c1+c2+c3+c4+c5+c6;i1=0;j1=0;k1=0;l1=0;i2=0;j2=0;k2=0;l2=0;i3=0;j3=0;k3=0;l3=0;i1=simplex[c][0]>=3?1:0;j1=simplex[c][1]>=3?1:0;k1=simplex[c][2]>=3?1:0;l1=simplex[c][3]>=3?1:0;i2=simplex[c][0]>=2?1:0;j2=simplex[c][1]>=2?1:0;k2=simplex[c][2]>=2?1:0;l2=simplex[c][3]>=2?1:0;i3=simplex[c][0]>=1?1:0;j3=simplex[c][1]>=1?1:0;k3=simplex[c][2]>=1?1:0;l3=simplex[c][3]>=1?1:0;x1=x0-i1+G4;y1=y0-j1+G4;z1=z0-k1+G4;w1=w0-l1+G4;x2=x0-i2+2*G4;y2=y0-j2+2*G4;z2=z0-k2+2*G4;w2=w0-l2+2*G4;x3=x0-i3+3*G4;y3=y0-j3+3*G4;z3=z0-k3+3*G4;w3=w0-l3+3*G4;x4=x0-1+4*G4;y4=y0-1+4*G4;z4=z0-1+4*G4;w4=w0-1+4*G4;ii=i&255;jj=j&255;kk=k&255;ll=l&255;gi0=perm[ii+perm[jj+perm[kk+perm[ll]]]]%32;gi1=perm[ii+i1+perm[jj+j1+perm[kk+k1+perm[ll+l1]]]]%32;gi2=perm[ii+i2+perm[jj+j2+perm[kk+k2+perm[ll+l2]]]]%32;gi3=perm[ii+i3+perm[jj+j3+perm[kk+k3+perm[ll+l3]]]]%32;gi4=perm[ii+1+perm[jj+1+perm[kk+1+perm[ll+1]]]]%32;t0=.6-x0*x0-y0*y0-z0*z0-w0*w0;if(!(t0<0)){t0*=t0;n0=t0*t0*dot(grad4[gi0],x0,y0,z0,w0)}t1=.6-x1*x1-y1*y1-z1*z1-w1*w1;if(!(t1<0)){t1*=t1;n1=t1*t1*dot(grad4[gi1],x1,y1,z1,w1)}t2=.6-x2*x2-y2*y2-z2*z2-w2*w2;if(!(t2<0)){t2*=t2;n2=t2*t2*dot(grad4[gi2],x2,y2,z2,w2)}t3=.6-x3*x3-y3*y3-z3*z3-w3*w3;if(!(t3<0)){t3*=t3;n3=t3*t3*dot(grad4[gi3],x3,y3,z3,w3)}t4=.6-x4*x4-y4*y4-z4*z4-w4*w4;if(!(t4<0)){t4*=t4;n4=t4*t4*dot(grad4[gi4],x4,y4,z4,w4)}return 27*(n0+n1+n2+n3+n4)};return SimplexNoise}(Noise);FlowNoise=function(_super){var TWO_PI,n;__extends(FlowNoise,_super);n=128;TWO_PI=Math.PI*2;FlowNoise.prototype.basis=[];FlowNoise.prototype.perm=[];function FlowNoise(rng){var i,theta,_i;if(rng==null){rng=Math}for(i=_i=0;0<=n?_i<=n:_i>=n;i=0<=n?++_i:--_i){theta=i*TWO_PI/n;this.basis[i]=[Math.cos(theta,Math.sin(theta))];this.perm[i]=i}reinitialize(rng.random()*1e3|0)}FlowNoise.prototype.reinitialize=function(seed){var i,j,_i,_results;_results=[];for(i=_i=1;1<=n?_i<=n:_i>=n;i=1<=n?++_i:--_i){j=Math.random()*seed%(i+1);_results.push(seed+=1)}return _results};return FlowNoise}(Noise);module.exports={SimplexNoise:SimplexNoise}}).call(this)},{}],8:[function(require,module,exports){(function(){var Vec2,Vec3;Vec2=function(){Vec2.prototype.x=0;Vec2.prototype.y=0;function Vec2(x,y){this.x=x!=null?x:0;this.y=y!=null?y:0}Vec2.prototype.set=function(v){this.x=v.x;this.y=v.y;return this};Vec2.prototype.set2=function(x,y){this.x=x;this.y=y;return this};Vec2.prototype.zero=function(){this.x=this.y=0;return this};Vec2.prototype.add=function(v){this.x+=v.x;this.y+=v.y;return this};Vec2.prototype.add_=function(v){return new Vec2(this.x+v.x,this.y+v.y)};Vec2.prototype.sub=function(v){this.x-=v.x;this.y-=v.y;return this};Vec2.prototype.sub_=function(v){return new Vec2(this.x-v.x,this.y-v.y)};Vec2.prototype.mul=function(v){this.x*=v.x;this.y*=v.y;return this};Vec2.prototype.mul_=function(v){return new Vec2(this.x*v.x,this.y*v.y)};Vec2.prototype.div=function(v){this.x/=v.x;this.y/=v.y;return this};Vec2.prototype.div_=function(v){return new Vec2(this.x/v.x,this.y/v.y)};Vec2.prototype.scale=function(value){this.x*=value;this.y*=value;return this};Vec2.prototype.scale_=function(value){return new Vec2(this.x*value,this.y*value)};Vec2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vec2.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};Vec2.prototype.normalize=function(){var l;l=this.length();if(l!==0){this.x/=l;this.y/=l}return this};Vec2.prototype.normalize_=function(){return this.clone().normalize()};Vec2.prototype.normalizeTo=function(length){var magnitude;magnitude=Math.sqrt(this.x*this.x+this.y*this.y);if(magnitude>0){magnitude=length/magnitude;this.x*=magnitude;this.y*=magnitude}return this};Vec2.prototype.normalizeTo_=function(length){return this.clone().normalizeTo_(length)};Vec2.prototype.distance=function(v){return Math.sqrt(this.distanceSquared2(v.x,v.y))};Vec2.prototype.distanceSquared=function(v){return this.distanceSquared2(v.x,v.y)};Vec2.prototype.distanceSquared2=function(x,y){var dx,dy;dx=this.x-x;dy=this.y-y;return dx*dx+dy*dy};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y};Vec2.prototype.rotate=function(angle){var cosa,rx,ry,sina;sina=Math.sin(angle);cosa=Math.cos(angle);rx=this.x*cosa-this.y*sina;ry=this.x*sina+this.y*cosa;this.x=rx;return this.y=ry};Vec2.prototype.jitter=function(amount){this.x+=(Math.random()*2-1)*amount;this.y+=(Math.random()*2-1)*amount;return this};Vec2.prototype.jitter_=function(amount){return new Vec2(this.x,this.y).jitter(amount)};Vec2.prototype.lerp=function(target,delta){this.x=this.x*(1-delta)+target.x*delta;this.y=this.y*(1-delta)+target.y*delta;return this};Vec2.prototype.lerp_=function(target,delta){return new Vec2(this.x,this.y).lerp(target,delta)};Vec2.prototype.equals=function(v){return this.x===v.x&&this.y===v.y};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)};Vec2.prototype.toString=function(){return"Vec2("+this.x+", "+this.y+")"};return Vec2}();Vec3=function(){Vec3.prototype.x=0;Vec3.prototype.y=0;Vec3.prototype.z=0;function Vec3(x,y,z){this.x=x!=null?x:0;this.y=y!=null?y:0;this.z=z!=null?z:0}Vec3.prototype.set=function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this};Vec3.prototype.set3=function(x,y,z){this.x=x;this.y=y;this.z=z;return this};Vec3.prototype.zero=function(){this.x=this.y=this.z=0;return this};Vec3.prototype.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this};Vec3.prototype.add_=function(v){return new Vec3(this.x+v.x,this.y+v.y,this.z+v.z)};Vec3.prototype.sub=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this};Vec3.prototype.sub_=function(v){return new Vec3(this.x-v.x,this.y-v.y,this.z-v.z)};Vec3.prototype.mul=function(v){this.x*=v.x;this.y*=v.y;return this};Vec3.prototype.mul_=function(v){return new Vec3(this.x*v.x,this.y*v.y,this.z*v.z)};Vec3.prototype.div=function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this};Vec3.prototype.div_=function(v){return new Vec3(this.x/v.x,this.y/v.y,this.z=v.z)};Vec3.prototype.scale=function(value){this.x*=value;this.y*=value;this.z*=value;return this};Vec3.prototype.scale_=function(value){return new Vec3(this.x*value,this.y*value,this.z*value)};Vec3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};Vec3.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z};Vec3.prototype.normalize=function(){var l;l=this.length();if(l!==0){this.x/=l;this.y/=l;this.z/=l}return this};Vec3.prototype.normalize_=function(){return this.clone().normalize()};Vec3.prototype.normalizeTo=function(length){var magnitude;magnitude=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(magnitude>0){magnitude=length/magnitude;this.x*=magnitude;this.y*=magnitude}return this};Vec3.prototype.normalizeTo_=function(length){return this.clone().normalizeTo_(length)};Vec3.prototype.distance=function(v){return Math.sqrt(this.distanceSquared3(v.x,v.y,v.z))};Vec3.prototype.distanceSquared=function(v){return this.distanceSquared3(v.x,v.y,v.z)};Vec3.prototype.distanceSquared3=function(x,y,z){var dx,dy,dz;dx=this.x-x;dy=this.y-y;dz=this.z-z;return dx*dx+dy*dy+dz*dz};Vec3.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z};Vec3.prototype.jitter=function(amount){this.x+=(Math.random()*2-1)*amount;this.y+=(Math.random()*2-1)*amount;this.z+=(Math.random()*2-1)*amount;return this};Vec3.prototype.jitter_=function(amount){return new Vec3(this.x,this.y,this.z).jitter(amount)};Vec3.prototype.lerp=function(target,delta){this.x=this.x*(1-delta)+target.x*delta;this.y=this.y*(1-delta)+target.y*delta;this.z=this.z*(1-delta)+target.z*delta;return this};Vec3.prototype.lerp_=function(target,delta){return new Vec3(this.x,this.y,this.z).lerp(target,delta)};Vec3.prototype.equals=function(v){return this.x===v.x&&this.y===v.y&&this.z===v.z};Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)};Vec3.prototype.toString=function(){return"Vec3("+this.x+", "+this.y+", "+this.z+")"};return Vec3}();module.exports={Vec2:Vec2,Vec3:Vec3}}).call(this)},{}],5:[function(require,module,exports){(function(){var random,randomPkg;randomPkg=require("./random");random=new randomPkg.Random;module.exports={fit:function(value,inMin,inMax,outMin,outMax){return(value-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},fit01:function(value,min,max){return value*(max-min)+min},clamp:function(value,min,max){return Math.max(min,Math.min(max,value))},clamp01:function(value){return Math.max(0,Math.min(1,value))},randf:function(min,max){return random.randf(min,max)},randi:function(min,max){return random.randi(min,max)},flipCoin:function(chance){return random.flipCoin(chance)},ease:{linear:function(t){return t},inQuad:function(t){return Math.pow(t,2)},outQuad:function(t){return-(Math.pow(t-1,2)-1)},inOutQuad:function(t){if((t/=.5)<1){return.5*Math.pow(t,2)}return-.5*((t-=2)*t-2)},inCubic:function(t){return Math.pow(t,3)},outCubic:function(t){return Math.pow(t-1,3)+1},inOutCubic:function(t){if((t/=.5)<1){return.5*Math.pow(t,3)}return.5*(Math.pow(t-2,3)+2)},inQuart:function(t){return Math.pow(t,4)},outQuart:function(t){return-(Math.pow(t-1,4)-1)},inOutQuart:function(t){if((t/=.5)<1){return.5*Math.pow(t,4)}return-.5*((t-=2)*Math.pow(t,3)-2)},inQuint:function(t){return Math.pow(t,5)},outQuint:function(t){return Math.pow(t-1,5)+1},inOutQuint:function(t){if((t/=.5)<1){return.5*Math.pow(t,5)}return.5*(Math.pow(t-2,5)+2)},inSine:function(t){return-Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){if(t===0){return 0}else{return Math.pow(2,10*(t-1))}},outExpo:function(t){if(t===1){return 1}else{return-Math.pow(2,-10*t)+1}},inOutExpo:function(t){if(t===0){return 0}if(t===1){return 1}if((t/=.5)<1){return.5*Math.pow(2,10*(t-1))}return.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOutCirc:function(t){if((t/=.5)<1){return-.5*(Math.sqrt(1-t*t)-1)}return.5*(Math.sqrt(1-(t-=2)*t)+1)},outBounce:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},inBack:function(t){var s;s=1.70158;return t*t*((s+1)*t-s)},outBack:function(t){var s;s=1.70158;return(t=t-1)*t*((s+1)*t+s)+1},inOutBack:function(t){var s;s=1.70158;if((t/=.5)<1){return.5*t*t*(((s*=1.525)+1)*t-s)}return.5*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)},elastic:function(t){return-1*Math.pow(4,-8*t)*Math.sin((t*6-1)*2*Math.PI/2)+1},swingFromTo:function(t){var s;s=1.70158;if((t/=.5)<1){return.5*t*t*(((s*=1.525)+1)*t-s)}else{return.5*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)}},swingFrom:function(t){var s;s=1.70158;return t*t*((s+1)*t-s)},swingTo:function(t){var s;s=1.70158;return(t-=1)*t*((s+1)*t+s)+1},bounce:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},bouncePast:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 2-(7.5625*(t-=1.5/2.75)*t+.75)}else if(t<2.5/2.75){return 2-(7.5625*(t-=2.25/2.75)*t+.9375)}else{return 2-(7.5625*(t-=2.625/2.75)*t+.984375)}},fromTo:function(t){if((t/=.5)<1){return.5*Math.pow(t,4)}return-.5*((t-=2)*Math.pow(t,3)-2)},from:function(t){return Math.pow(t,4)},to:function(t){return Math.pow(t,.25)}}}}).call(this)},{"./random":6}],9:[function(require,module,exports){(function(){var Rect,Vec2;Vec2=require("./vector").Vec2;Rect=function(){Rect.prototype.x1=0;Rect.prototype.y1=0;Rect.prototype.x2=0;Rect.prototype.y2=0;function Rect(x1,y1,x2,y2){this.x1=x1!=null?x1:0;this.y1=y1!=null?y1:0;this.x2=x2!=null?x2:0;this.y2=y2!=null?y2:0}Rect.prototype.center=function(){var x,y;x=Math.min(this.x1,this.x2)+this.width()*.5;y=Math.min(this.y1,this.y2)+this.height()*.5;return new Vec2(x,y)};Rect.prototype.width=function(){return Math.abs(this.x1-this.x2)};Rect.prototype.height=function(){return Math.abs(this.y1-this.y2)};return Rect}();module.exports.Rect=Rect}).call(this)},{"./vector":8}],10:[function(require,module,exports){(function(){var Behaviour,Constraint,Emitter,Particle,Physics,Space,Spring,particleModule,util,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};util=require("../util");particleModule=require("./particle");Particle=particleModule.Particle;Physics=function(){Physics.prototype.particles=[];Physics.prototype.springs=[];Physics.prototype.behaviours=[];Physics.prototype.constraints=[];Physics.prototype.emitter=null;Physics.prototype.space=null;Physics.prototype.constraintIterations=1;Physics.prototype.springIterations=1;function Physics(){this.space=new Space;this.emitter=new Emitter(this);this.clear()}Physics.prototype.clear=function(){this.particles=[];this.behaviours=[];return this.constraints=[]};Physics.prototype.add=function(){var arg,state;if(arguments.length===0){return}arg=arguments[0];if(arg instanceof Particle){this.addParticle(arg)}else if(arg instanceof Behaviour){console.log("adding behaviour "+arg);if(arguments.length>1){state=arguments[1]}this.addBehaviour(arg,state)}else if(arg instanceof Spring){console.log("adding spring "+arg);this.addSpring(arg)}else{"Cannot add "+arg}return arg};Physics.prototype.addParticle=function(particle){this.particles.push(particle);return particle};Physics.prototype.addSpring=function(spring){this.springs.push(spring);return spring};Physics.prototype.addBehaviour=function(effector,state){var list;if(state==null){state=particleModule.State.ALIVE}list=effector instanceof Constraint?this.constraints:this.behaviours;if(!list[state]){list[state]=[]}return list[state].push(effector)};Physics.prototype.update=function(){var dead,i,j,particle,particles,spring,stateDead,_i,_j,_k,_l,_len,_len1,_ref,_ref1,_ref2;this.emitter.update();this.space.update(this);particles=this.particles;this.applyEffectors(this.behaviours,particles);for(j=_i=0,_ref=this.constraintIterations;0<=_ref?_i<=_ref:_i>=_ref;j=0<=_ref?++_i:--_i){this.applyEffectors(this.constraints,particles);for(i=_j=0,_ref1=this.springIterations;0<=_ref1?_j<=_ref1:_j>=_ref1;i=0<=_ref1?++_j:--_j){_ref2=this.springs;for(_k=0,_len=_ref2.length;_k<_len;_k++){spring=_ref2[_k];spring.update()}}}dead=[];stateDead=particleModule.State.DEAD;for(_l=0,_len1=particles.length;_l<_len1;_l++){particle=particles[_l];particle.update();if(particle.state===stateDead){dead.push(particle)}void 0}i=dead.length;while(i--){particle=dead[i];util.removeElement(particle,particles);void 0}return void 0};Physics.prototype.applyEffectors=function(effectors,particles){var effector,particle,state,stateEffectors,_i,_j,_len,_len1;state=effectors.length;while(state--){stateEffectors=effectors[state];for(_i=0,_len=stateEffectors.length;_i<_len;_i++){effector=stateEffectors[_i];effector.prepare(this);for(_j=0,_len1=particles.length;_j<_len1;_j++){particle=particles[_j];if(particle.state===state&&!particle.isLocked){effector.apply(particle)}void 0}void 0}void 0}return void 0};Physics.prototype.size=function(){return this.particles.length};return Physics}();Space=function(){var physics;physics=null;function Space(){}Space.prototype.update=function(physics_){return physics=physics_};Space.prototype.search=function(center,radius){var particle,radiusSq,result,_i,_len,_ref;result=[];radiusSq=radius*radius;_ref=physics.particles;for(_i=0,_len=_ref.length;_i<_len;_i++){particle=_ref[_i];if(center.distanceSquared(particle.position)<radiusSq){result.push(particle)}}return result};return Space}();Emitter=function(){var id,timer;Emitter.prototype.rate=1;Emitter.prototype.interval=1;Emitter.prototype.max=100;Emitter.prototype.type=particleModule.Particle3;timer=-1;id=0;function Emitter(physics){this.physics=physics}Emitter.prototype.update=function(){var i,p;if(timer===-1||timer>=this.interval){timer=0;i=0;while(i<this.rate&&this.physics.size()<this.max){p=this.create();this.init(p);i++}}return timer++};Emitter.prototype.create=function(){var p;p=new this.type(id++);this.physics.addParticle(p);return p};Emitter.prototype.init=function(particle){};return Emitter}();Behaviour=function(){function Behaviour(){}Behaviour.prototype.prepare=function(){};Behaviour.prototype.apply=function(particle){};return Behaviour}();Constraint=function(_super){__extends(Constraint,_super);function Constraint(){return Constraint.__super__.constructor.apply(this,arguments)}Constraint.prototype.prepare=function(){};Constraint.prototype.apply=function(particle){};return Constraint}(Behaviour);Spring=function(){Spring.prototype.a=null;Spring.prototype.b=null;Spring.prototype.restLength=0;Spring.prototype.strength=.5;function Spring(a,b,strength){this.a=a;this.b=b;this.strength=strength!=null?strength:.5;this.restLength=this.a.position.distance(this.b.position)}Spring.prototype.update=function(){var delta,dist,normDistStrength;delta=this.b.position.sub_(this.a.position);dist=delta.length()+Number.MIN_VALUE;normDistStrength=(dist-this.restLength)/dist*this.strength;if(normDistStrength===0){return}delta.scale(normDistStrength);if(!this.a.isLocked){this.a.position.add(delta)}if(!this.b.isLocked){return this.b.position.sub(delta)}};Spring.prototype.toString=function(){return"Spring("+a+", "+b+")"};return Spring}();module.exports={Physics:Physics,Emitter:Emitter,Space:Space,Behaviour:Behaviour,Constraint:Constraint,Spring:Spring}}).call(this)},{"../util":2,"./particle":11}],11:[function(require,module,exports){(function(){var Particle,Particle2,Particle3,State,Vec2,Vec3,vector,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};vector=require("../math/vector");Vec2=vector.Vec2;Vec3=vector.Vec3;State={ALIVE:0,LOCKED:1,IDLE:2,DEAD:3};Particle=function(){Particle.prototype.id=0;Particle.prototype.state=State.ALIVE;Particle.prototype.age=0;Particle.prototype.lifetime=-1;Particle.prototype.size=1;Particle.prototype.isLocked=false;Particle.prototype.position=null;Particle.prototype.drag=.03;Particle.prototype.prev=null;Particle.prototype.force=null;Particle.prototype.velocity=null;function Particle(id){this.id=id}Particle.prototype.clearVelocity=function(){return this.prev.set(this.position)};Particle.prototype.scaleVelocity=function(amount){return this.prev.lerp(this.position,1-amount)};Particle.prototype.setPosition=function(v){this.position.set(v);return this.prev.set(v)};Particle.prototype.lock=function(){return this.state=State.LOCKED};Particle.prototype.unlock=function(){return this.state=State.ALIVE};Particle.prototype.die=function(){return this.state=State.DEAD};Particle.prototype.idle=function(){return this.state=State.IDLE};Particle.prototype.toString=function(){return"Particle("+this.position+")"};return Particle}();Particle3=function(_super){var tmp;__extends(Particle3,_super);tmp=new Vec3;function Particle3(id){this.id=id;this.position=new Vec3;this.prev=new Vec3;this.force=new Vec3;this.velocity=new Vec3}Particle3.prototype.update=function(){this.age++;if(this.state>State.ALIVE){return}if(this.lifetime>0&&this.age===this.lifetime){this.state=State.DEAD}tmp.set(this.position);this.position.x+=this.position.x-this.prev.x+this.force.x;this.position.y+=this.position.y-this.prev.y+this.force.y;this.position.z+=this.position.z-this.prev.z+this.force.z;this.prev.set(tmp);this.prev.lerp(this.position,this.drag);return this.force.zero()};Particle3.prototype.setPosition3=function(x,y,z){this.position.set3(x,y,z);return this.prev.set3(x,y,z)};return Particle3}(Particle);Particle2=function(_super){var tmp;__extends(Particle2,_super);tmp=new Vec2;function Particle2(id){this.id=id;this.position=new Vec2;this.prev=new Vec2;this.force=new Vec2;this.velocity=new Vec2}Particle2.prototype.update=function(){this.age++;if(this.state>State.ALIVE){return}if(this.lifetime>0&&this.age===this.lifetime){this.state=State.DEAD}tmp.set(this.position);this.position.x+=this.position.x-this.prev.x+this.force.x;this.position.y+=this.position.y-this.prev.y+this.force.y;this.prev.set(tmp);this.prev.lerp(this.position,this.drag);return this.force.zero()};Particle2.prototype.setPosition2=function(x,y){this.position.set2(x,y);return this.prev.set2(x,y)};return Particle2}(Particle);module.exports={Particle:Particle,Particle2:Particle2,Particle3:Particle3,State:State}}).call(this)},{"../math/vector":8}],12:[function(require,module,exports){(function(){var Attractor,Behaviour,Force,Vec2,Vec3,physics,vector,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};vector=require("../math/vector");Vec2=vector.Vec2;Vec3=vector.Vec3;physics=require("./physics");Behaviour=physics.Behaviour;Force=function(_super){var force;__extends(Force,_super);force=null;function Force(direction,weight){this.direction=direction;this.weight=weight!=null?weight:1}Force.prototype.prepare=function(){return force=this.direction.normalizeTo(this.weight)};Force.prototype.apply=function(particle){return particle.position.add(force)};Force.prototype.toString=function(){return"Force("+force+")"
};return Force}(Behaviour);Attractor=function(){var rangeSq,tmp;tmp=null;rangeSq=0;function Attractor(target,range,weight){this.target=target;this.range=range;this.weight=weight!=null?weight:1;tmp=this.target.clone()}Attractor.prototype.prepare=function(){return rangeSq=this.range*this.range};Attractor.prototype.apply=function(particle){var dist,distSq;tmp.set(this.target).sub(particle.position);distSq=tmp.lengthSquared();if(distSq>0&&distSq<rangeSq){dist=Math.sqrt(distSq);tmp.scale(1/dist*(1-dist/this.range)*this.weight);return particle.force.add(tmp)}};Attractor.prototype.toString=function(){return"Attractor("+this.target+", "+this.range+", "+this.weight+")"};return Attractor}();module.exports={Force:Force,Attractor:Attractor}}).call(this)},{"../math/vector":8,"./physics":10}],13:[function(require,module,exports){(function(){var Area,Box,Collision,Constraint,Vec2,Vec3,Wrap2,Wrap3,physics,vector,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};vector=require("../math/vector");Vec2=vector.Vec2;Vec3=vector.Vec3;physics=require("./physics");Constraint=physics.Constraint;Box=function(_super){__extends(Box,_super);function Box(min,max){this.min=min!=null?min:new Vec3;this.max=max!=null?max:new Vec3(100,100,100)}Box.prototype.apply=function(particle){var pos;pos=particle.position;if(pos.x<this.min.x){pos.x=this.min.x}if(pos.y<this.min.y){pos.y=this.min.y}if(pos.z<this.min.z){pos.z=this.min.z}if(pos.x>this.max.x){pos.x=this.max.x}if(pos.y>this.max.y){pos.y=this.max.y}if(pos.z>this.max.z){return pos.z=this.max.z}};Box.prototype.toString=function(){return"Box("+this.min+", "+this.max+")"};return Box}(Constraint);Area=function(_super){__extends(Area,_super);function Area(min,max){this.min=min!=null?min:new Vec2;this.max=max!=null?max:new Vec2(100,100)}Area.prototype.apply=function(particle){var pos;pos=particle.position;if(pos.x<this.min.x){pos.x=this.min.x}if(pos.y<this.min.y){pos.y=this.min.y}if(pos.x>this.max.x){pos.x=this.max.x}if(pos.y>this.max.y){return pos.y=this.max.y}};Area.prototype.toString=function(){return"Area("+this.min+", "+this.max+")"};return Area}(Constraint);Wrap2=function(_super){var delta;__extends(Wrap2,_super);delta=new Vec2;function Wrap2(min,max){this.min=min!=null?min:new Vec2;this.max=max!=null?max:new Vec2(100,100)}Wrap2.prototype.prepare=function(){return delta.set(this.max).sub(this.min)};Wrap2.prototype.apply=function(particle){var pos,prev;pos=particle.position;prev=particle.prev;if(pos.x<this.min.x){pos.x+=delta.x;prev.x+=delta.x}if(pos.y<this.min.y){pos.y+=delta.y;prev.y+=delta.y}if(pos.x>this.max.x){pos.x-=delta.x;prev.x-=delta.x}if(pos.y>this.max.y){pos.y-=delta.y;return prev.y-=delta.y}};Wrap2.prototype.toString=function(){return"Wrap2("+this.min+", "+this.max+")"};return Wrap2}(Constraint);Wrap3=function(_super){var delta;__extends(Wrap3,_super);delta=new Vec3;function Wrap3(min,max){this.min=min!=null?min:new Vec3;this.max=max!=null?max:new Vec3(100,100,100)}Wrap3.prototype.prepare=function(){return delta.set(this.max).sub(this.min)};Wrap3.prototype.apply=function(particle){var pos,prev;pos=particle.position;prev=particle.prev;if(pos.x<this.min.x){pos.x+=delta.x;prev.x+=delta.x}if(pos.y<this.min.y){pos.y+=delta.y;prev.y+=delta.y}if(pos.z<this.min.z){pos.z+=delta.z;prev.z+=delta.z}if(pos.x>this.max.x){pos.x-=delta.x;prev.x-=delta.x}if(pos.y>this.max.y){pos.y-=delta.y;prev.y-=delta.y}if(pos.z>this.max.z){pos.z-=delta.z;return prev.z-=delta.z}};Wrap3.prototype.toString=function(){return"Wrap3("+this.min+", "+this.max+")"};return Wrap3}(Constraint);Collision=function(_super){__extends(Collision,_super);Collision.prototype.physics=null;Collision.prototype.searchRadius=100;function Collision(physics){this.physics=physics}Collision.prototype.apply=function(particle){var delta,dist,distSq,neighbour,neighbours,position,radius,radiusSq,_i,_len;position=particle.position;delta=position.clone();neighbours=this.physics.space.search(position,this.searchRadius);for(_i=0,_len=neighbours.length;_i<_len;_i++){neighbour=neighbours[_i];if(neighbour===particle){continue}delta.set(position).sub(neighbour.position);distSq=delta.lengthSquared();radius=particle.size+neighbour.size;radiusSq=radius*radius;if(distSq<radiusSq){dist=Math.sqrt(distSq);delta.scale((dist-radius)/radius*.5);particle.position.sub(delta);neighbour.position.add(delta)}void 0}return void 0};return Collision}(Constraint);module.exports={Box:Box,Area:Area,Wrap2:Wrap2,Wrap3:Wrap3,Collision:Collision}}).call(this)},{"../math/vector":8,"./physics":10}],14:[function(require,module,exports){(function(){var Color,Sketch,Vec2;Color=require("../color").Color;Vec2=require("../math/vector").Vec2;Sketch=function(){var TWO_PI,computeStyle,isFillEnabled,isStrokeEnabled;Sketch.prototype.width=-1;Sketch.prototype.height=-1;Sketch.prototype.canvasId="sketch";Sketch.prototype.domObjectId="container";Sketch.prototype.g=null;Sketch.prototype.mouseX=0;Sketch.prototype.mouseY=0;function Sketch(options){var canvas,domObject,_this=this;domObject=document.getElementById(this.domObjectId);if(this.width===-1){this.width=domObject.offsetWidth}if(this.height===-1){this.height=domObject.offsetHeight}canvas=document.createElement("canvas");canvas.id=this.canvasId;canvas.width=this.width;canvas.height=this.height;domObject.appendChild(canvas);this.g=canvas.getContext("2d");this.setup();this.start();domObject.onmousemove=function(e){_this.mouseX=e.x;return _this.mouseY=e.y};domObject.onmousedown=function(e){return _this.mouseDown()};domObject.onmouseup=function(e){return _this.mouseUp()}}Sketch.prototype.isRunning=false;Sketch.prototype.isFinishedCallback=null;Sketch.prototype.start=function(){var render,requestId,_this=this;this.isRunning=true;requestId=null;render=function(){_this.draw();if(_this.isRunning){return requestId=window.requestAnimationFrame(render)}else{window.cancelAnimationFrame(requestId);if(_this.isFinishedCallback!=null){return _this.isFinishedCallback()}}};return requestId=window.requestAnimationFrame(render)};Sketch.prototype.stop=function(callback){this.isRunning=false;return this.isFinishedCallback=callback};Sketch.prototype.toString=function(){return"Sketch"};Sketch.prototype.setup=function(){};Sketch.prototype.draw=function(){};Sketch.prototype.mouseDown=function(){};Sketch.prototype.mouseUp=function(){};isFillEnabled=true;isStrokeEnabled=false;TWO_PI=Math.PI*2;computeStyle=function(args){var arg,grey;switch(args.length){case 1:arg=args[0];if(typeof arg==="string"){return arg}else if(arg instanceof Color){return arg.toCSS()}else{return"rgba("+arg+", "+arg+", "+arg+", 1)"}break;case 2:grey=args[0];return"rgba("+grey+", "+grey+", "+grey+", "+args[1]+")";case 3:return"rgba("+args[0]+", "+args[1]+", "+args[2]+", 1)";case 4:return"rgba("+args[0]+", "+args[1]+", "+args[2]+", "+args[3]+")";default:return"#FF0000"}};Sketch.prototype.color=function(){return computeStyle(arguments)};Sketch.prototype.background=function(){var style;this.g.clearRect(0,0,this.width,this.height);style=this.g.fillStyle;this.g.fillStyle=computeStyle(arguments);this.g.fillRect(0,0,this.width,this.height);return this.g.fillStyle=style};Sketch.prototype.fill=function(){isFillEnabled=true;return this.g.fillStyle=computeStyle(arguments)};Sketch.prototype.stroke=function(){isStrokeEnabled=true;return this.g.strokeStyle=computeStyle(arguments)};Sketch.prototype.lineWidth=function(width){return this.g.lineWidth=width};Sketch.prototype.noFill=function(){return isFillEnabled=false};Sketch.prototype.noStroke=function(){return isStrokeEnabled=false};Sketch.prototype.rect=function(x,y,w,h){if(isFillEnabled){this.g.fillRect(x,y,w,h)}if(isStrokeEnabled){return this.g.strokeRect(x,y,w,h)}};Sketch.prototype.circle=function(x,y,r){this.g.beginPath();this.g.arc(x,y,r,0,TWO_PI,false);if(isFillEnabled){this.g.fill()}if(isStrokeEnabled){this.g.stroke()}return this.g.closePath()};Sketch.prototype.line=function(x1,y1,x2,y2){this.g.beginPath();if(x1 instanceof Vec2){this.g.moveTo(x1.x,x1.y);this.g.lineTo(y1.x,y1.y)}else{this.g.moveTo(x1,y1);this.g.lineTo(x2,y2)}this.g.stroke();return this.g.closePath()};Sketch.prototype.polygon=function(points){var p,_i,_len,_ref;this.g.beginPath();this.g.moveTo(points[0].x,points[0].y);_ref=points.slice(1);for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];this.g.lineTo(p.x,p.y)}if(isFillEnabled){this.g.fill()}if(isStrokeEnabled){this.g.stroke()}return this.g.closePath()};Sketch.prototype.createImage=function(width,height){var imageData;imageData=this.g.createImageData(width,height);imageData.setPixel=function(x,y,r,g,b,a){var index;if(a==null){a=255}index=(x+y*this.width)*4;this.data[index+0]=r;this.data[index+1]=g;this.data[index+2]=b;return this.data[index+3]=a};return imageData};Sketch.prototype.drawImage=function(imageData,x,y){return this.g.putImageData(imageData,x,y)};return Sketch}();module.exports={Sketch:Sketch}}).call(this)},{"../color":3,"../math/vector":8}],6:[function(require,module,exports){(function(){var Random,mersenne;mersenne=require("mersenne");Random=function(){function Random(initialSeed){if(initialSeed==null){initialSeed=0}this.seed(initialSeed)}Random.prototype.seed=function(value){this.seedValue=value;return mersenne.seed(this.seedValue)};Random.prototype.toString=function(){return"Random("+this.seedValue+")"};Random.prototype.random=function(){var k;k=1e6;return mersenne.rand(k)/k};Random.prototype.randi=function(min,max){return Math.floor(this.random()*(max-min)+min)};Random.prototype.randf=function(min,max){return this.random()*(max-min)+min};Random.prototype.flipCoin=function(chance){if(chance==null){chance=.5}return this.random()<chance};Random.prototype.shuffle=function(list){return list.sort(function(){return.5-this.random()})};Random.prototype.pick=function(list,count){var i,indices,result,_i,_j,_ref;if(count==null){count=1}switch(list.length){case 0:return null;case 1:return list[0];default:if(count===1){return list[this.randi(0,list.length)]}else{indices=[];for(i=_i=0,_ref=list.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){indices.push(i)}exports.shuffle(indices);result=[];for(i=_j=0;0<=count?_j<count:_j>count;i=0<=count?++_j:--_j){result.push(list[indices[i]])}return result}}};Random.prototype.pickAB=function(listA,listB,chance){var list;list=this.next()<chance?listA:listB;return this.pick(list)};return Random}();module.exports.Random=Random}).call(this)},{mersenne:15}],15:[function(require,module,exports){function MersenneTwister19937(){var N,M,MATRIX_A,UPPER_MASK,LOWER_MASK;N=624;M=397;MATRIX_A=2567483615;UPPER_MASK=2147483648;LOWER_MASK=2147483647;var mt=new Array(N);var mti=N+1;function unsigned32(n1){return n1<0?(n1^UPPER_MASK)+UPPER_MASK:n1}function subtraction32(n1,n2){return n1<n2?unsigned32(4294967296-(n2-n1)&4294967295):n1-n2}function addition32(n1,n2){return unsigned32(n1+n2&4294967295)}function multiplication32(n1,n2){var sum=0;for(var i=0;i<32;++i){if(n1>>>i&1){sum=addition32(sum,unsigned32(n2<<i))}}return sum}this.init_genrand=function(s){mt[0]=unsigned32(s&4294967295);for(mti=1;mti<N;mti++){mt[mti]=addition32(multiplication32(1812433253,unsigned32(mt[mti-1]^mt[mti-1]>>>30)),mti);mt[mti]=unsigned32(mt[mti]&4294967295)}};this.init_by_array=function(init_key,key_length){var i,j,k;this.init_genrand(19650218);i=1;j=0;k=N>key_length?N:key_length;for(;k;k--){mt[i]=addition32(addition32(unsigned32(mt[i]^multiplication32(unsigned32(mt[i-1]^mt[i-1]>>>30),1664525)),init_key[j]),j);mt[i]=unsigned32(mt[i]&4294967295);i++;j++;if(i>=N){mt[0]=mt[N-1];i=1}if(j>=key_length)j=0}for(k=N-1;k;k--){mt[i]=subtraction32(unsigned32((dbg=mt[i])^multiplication32(unsigned32(mt[i-1]^mt[i-1]>>>30),1566083941)),i);mt[i]=unsigned32(mt[i]&4294967295);i++;if(i>=N){mt[0]=mt[N-1];i=1}}mt[0]=2147483648};var mag01=[0,MATRIX_A];this.genrand_int32=function(){var y;if(mti>=N){var kk;if(mti==N+1)this.init_genrand(5489);for(kk=0;kk<N-M;kk++){y=unsigned32(mt[kk]&UPPER_MASK|mt[kk+1]&LOWER_MASK);mt[kk]=unsigned32(mt[kk+M]^y>>>1^mag01[y&1])}for(;kk<N-1;kk++){y=unsigned32(mt[kk]&UPPER_MASK|mt[kk+1]&LOWER_MASK);mt[kk]=unsigned32(mt[kk+(M-N)]^y>>>1^mag01[y&1])}y=unsigned32(mt[N-1]&UPPER_MASK|mt[0]&LOWER_MASK);mt[N-1]=unsigned32(mt[M-1]^y>>>1^mag01[y&1]);mti=0}y=mt[mti++];y=unsigned32(y^y>>>11);y=unsigned32(y^y<<7&2636928640);y=unsigned32(y^y<<15&4022730752);y=unsigned32(y^y>>>18);return y};this.genrand_int31=function(){return this.genrand_int32()>>>1};this.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)};this.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)};this.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)};this.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(a*67108864+b)*(1/9007199254740992)}}exports.MersenneTwister19937=MersenneTwister19937;var gen=new MersenneTwister19937;gen.init_genrand((new Date).getTime()%1e9);exports.rand=function(N){if(!N){N=32768}return Math.floor(gen.genrand_real2()*N)};exports.seed=function(S){if(typeof S!="number"){throw new Error("seed(S) must take numeric argument; is "+typeof S)}gen.init_genrand(S)};exports.seed_array=function(A){if(typeof A!="object"){throw new Error("seed_array(A) must take array of numbers; is "+typeof A)}gen.init_by_array(A)}},{}]},{},[1]);